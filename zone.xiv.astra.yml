app-id: zone.xiv.astra
runtime: org.kde.Platform
runtime-version: '6.6'
sdk: org.kde.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable
command: astra
build-options:
  append-path: /usr/lib/sdk/rust-stable/bin
  build-args:
    - --share=network
finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  - --filesystem=host
  - --device=dri
  - --share=network
  - --socket=pulseaudio
modules:
  - flatpak/kf6.json
  - flatpak/kirigami-addons.json
  - name: unshield
    buildsystem: cmake-ninja
    sources:
      - type: git
        url: https://github.com/twogood/unshield.git
        branch: main
  - name: unshield
    buildsystem: meson
    config-opts:
      - -Dmanpage=false
      - -Dvapi=false
      - -Dgtk_doc=false
      - -Dintrospection=false
      - -Dgcrypt=false
    sources:
      - type: archive
        url: https://download.gnome.org/sources/libsecret/0.20/libsecret-0.20.5.tar.xz
        sha256: 3fb3ce340fcd7db54d87c893e69bfc2b1f6e4d4b279065ffe66dac9f0fd12b4d
        x-checker-data:
        - type: gnome
        - name: libsecret
        - stable-only: true
  - name: qtkeychain
    buildsystem: cmake-ninja
    config-opts:
      - -DBUILD_WITH_QT6=ON
      - -DCMAKE_INSTALL_LIBDIR=/app/lib
      - -DLIB_INSTALL_DIR=/app/lib
      - -DBUILD_TRANSLATIONS=NO
    sources:
      - type: git
        url: https://github.com/frankosterfeld/qtkeychain.git
        branch: main
  - name: quazip
    buildsystem: cmake-ninja
    sources:
      - type: git
        url: https://github.com/stachenov/quazip.git
  #- name: icon
  #  buildsystem: simple
  #  build-commands:
  #    - mkdir -p /app/share/icons/hicolor/32x32/apps/
  #    - install -D /usr/share/icons/breeze/mimetypes/64/none.svg /app/share/icons/hicolor/32x32/apps/zone.xiv.astra.svg
  - name: qcoro
    buildsystem: cmake-ninja
    config-optios:
      - -DQCORO_BUILD_EXAMPLES=OFF
      - -DBUILD_TESTING=OFF
    sources:
      - type: archive
        url: https://github.com/danvratil/qcoro/archive/refs/tags/v0.7.0.tar.gz
        sha256: 23ef0217926e67c8d2eb861cf91617da2f7d8d5a9ae6c62321b21448b1669210
        x-checker-data:
          - type: anitya
            project-id: 236236
            stable-only: true
            url-template: https://github.com/danvratil/qcoro/archive/refs/tags/v$version.tar.gz
  - name: qt6-qtwebview
    buildsystem: cmake-ninja
    cleanup-platform:
      - /bin
    sources:
      - type: archive
        url: https://download.qt.io/official_releases/qt/6.6/6.6.1/submodules/qtwebview-everywhere-src-6.6.1.tar.xz
        sha256: d6de1ba33be93ae464147c9c069e115c7a24e3e475640016bc2f07c93c4a256c
        x-checker-data:
          - type: anitya
            project-id: 7927
            stable-only: true
            url-template: https://download.qt.io/official_releases/qt/6.6/$version/submodules/qtwebview-everywhere-src-$version.tar.xz
  - name: corrosion
    buildsystem: cmake-ninja
    config-opts:
      - DCORROSION_BUILD_TESTS=OFF
    build-options:
      - env:
        - CARGO_HOME: /run/build/corrosion/cargo
    cleanup:
      - /app
    sources:
      - type: "git"
        url: https://github.com/AndrewGaspar/corrosion
        commit: v0.4.5
  - name: astra
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DRust_COMPILER=/usr/lib/sdk/rust-stable/bin/rustc
      - -DENABLE_GAMEMODE=OFF
      - -DENABLE_CLI=OFF
      - -DBUILD_FLATPAK=ON
    build-options:
      build-args:
            - --share=network # needed for cargo unfortunately, flatpak has no native support (yet)
    sources:
      - type: dir
        path: .
